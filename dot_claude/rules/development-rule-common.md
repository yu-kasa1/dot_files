# 開発ルール 共通

## 開発の基本方針
- 「仕様駆動開発」を取り入れる。
- 動くコードを書くだけでなく、品質・保守性・安全性を常に意識する。
- 不明な点を勝手に自己解釈・補完せず、必ずユーザに確認すること。
- 問題を見つけたら放置せず、必ずユーザに発見報告と修正提案を行う。
- 開発は下記の3フェーズで行う。
    - 仕様設計：
        - ユーザから与えられた要件から仕様設計を行い、仕様ドキュメントを作成する。
        - ユーザと対話形式で仕様を練り上げる。
        - 不明な点をユーザとの対話で解消する。
        - ユーザのFBをもとに仕様を改善していき、完全な仕様ドキュメントを作り上げる。
        - この工程で作られたドキュメントが「唯一の正しい情報源」。
    - 実装：
        - 仕様ドキュメントが「唯一の正しい情報源」。
        - 前工程で作成した仕様ドキュメントをもとに実装を行う。
        - 制約やコーディングルールに従った実装を行う。
        - アップデートや改善を行った際は仕様ドキュメントも必ず更新する。
    - 動作確認・検証：
        - 実装が仕様ドキュメントに沿ったものか確認する。
        - 実装が要件を満たしているか確認する。
        - 実装が制約やコーディングルールに従っているか確認する。
        - 実装されたコードにより既存コードの処理を妨げていないか確認する。
        - 実装されたコードがそもそも動くのか確認する。

## ドキュメント
- ドキュメントをコードと同期して更新する。
- 実例を示すことを優先する。
- 設計思想や意図が明確に伝わるよう記述する。

## コード品質

### 基本原則
- DRY原則：重複を避け、単一の信頼できる情報源を維持する。
- 機能追加により既存コードの処理を妨げないことを意識する。
- プロジェクト全体で一貫したコーディングスタイルを維持する。
- 小さな問題も放置せず、発見次第必ずユーザに発見報告と修正提案を行う。(Broken Windows理論)

### 可読性
- 可読性の高いコードを書くこと。
- 意味のある変数名・関数名で意図を明確に伝えるようにする。
- ネストの深い書き方は避けること。(演算子の中で関数を使うなど)
- 複雑な処理は可能な限り避けること。(処理が複雑になる場合は分割してわかりやすく)

### コメント
- **Why優先**: なぜこの実装なのか（背景・制約・トレードオフ）を記載する。
- **複雑な処理のみHow**: アルゴリズムや複数ステップの処理にはサマリーを記載する。
- **Whatは書かない**: 関数名・変数名で表現する。コメントが必要なら命名を見直す。
- 技術的負債は明示的にコメントで記録する。

### 注意事項
- 不具合に繋がり得る記述は避けること。

## エラーハンドリング
- エラーの抑制(try-catchで握りつぶす等)ではなく、根本原因を修正することを心がける。
- 早期にエラーを検出し、明確なエラーメッセージを提供するよう実装する。
- 外部APIやネットワーク通信は失敗する可能性を考慮した設計とする。

## ログ出力
- 適切なエラーログ出力を行う設計にする。
- 不要なデバッグログは残さないようにする。
- ログが煩雑になることを避けるため、正常動作でログ出力をすることは避ける。

## セキュリティ
- APIキー、パスワード等は環境変数で管理する。(ハードコード禁止)
- 必要最小限の権限で動作させる。(最小権限の原則)
- 不要な依存関係を避ける設計とする。

## パフォーマンスの意識
- 初期段階から拡張性を考慮する。
- 必要になるまでリソースの読み込みを遅延する。
- N+1問題やオーバーフェッチを避けること。

## トレードオフの認識
- すべてを完璧にすることは不可能であることを理解する。(銀の弾丸は存在しない)
- 制約の中で最適なバランスを見つけること。
- 堅牢性を優先する。
- 妥協点とその理由を明確にドキュメント化やコメント追記する。

## Git運用
- Git操作が必要な場合は必ずユーザに確認すること。
- コミットやPushは行わないこと。(ユーザが実施するため)

## デバッグ
- 問題を確実に再現できる手順を確立する。
- 二分探索で問題の範囲を絞り込む。
- 最近の変更から調査を開始する。
- 調査結果と解決策を記録し、知識を共有する。

## 依存関係の管理
- 本当に必要な依存関係のみを追加する。
- 新しい依存関係追加前にライセンス、サイズ、メンテナンス状況を確認する。
